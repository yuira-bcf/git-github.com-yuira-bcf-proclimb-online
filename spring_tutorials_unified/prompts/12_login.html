<!doctype html>
<html lang="ja">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>ä¸Šç´š12 ãƒ­ã‚°ã‚¤ãƒ³èªè¨¼</title>
        <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700;900&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet" />
        <link rel="stylesheet" href="../style.css" />
        <style>
            .download-btn { background: linear-gradient(135deg, #22c55e, #16a34a); color: white; border: none; padding: 6px 14px; border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer; margin-left: auto; }
            .code-header { display: flex; align-items: center; justify-content: space-between; }
            .level-badge { display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: 600; background: #fee2e2; color: #991b1b; margin-right: 8px; }
        </style>
    </head>
    <body>
        <nav class="global-nav">
            <div class="nav-container">
                <a href="../1spring-framework-tutorial.html" class="nav-logo"><span class="nav-logo-icon">ğŸŒ±</span><span>Springå…¥é–€</span></a>
                <button class="nav-toggle" onclick="toggleMenu()"><span></span><span></span><span></span></button>
                <div class="nav-menu">
                    <div class="nav-menu-title">ğŸ“š ä¸Šç´šãƒ¬ãƒ™ãƒ«</div>
                    <ul class="nav-list">
                        <li class="nav-item"><a href="12_login.html" class="nav-link active"><span class="nav-chapter-num">12</span><span>ãƒ­ã‚°ã‚¤ãƒ³èªè¨¼</span></a></li>
                        <li class="nav-item"><a href="13_user_todo.html" class="nav-link"><span class="nav-chapter-num">13</span><span>ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥ToDoç®¡ç†</span></a></li>
                        <li class="nav-item"><a href="14_role.html" class="nav-link"><span class="nav-chapter-num">14</span><span>ãƒ­ãƒ¼ãƒ«åˆ¥æ¨©é™åˆ¶å¾¡</span></a></li>
                        <li class="nav-item"><a href="15_rest_api.html" class="nav-link"><span class="nav-chapter-num">15</span><span>REST APIåŒ–</span></a></li>
                        <li class="nav-item"><a href="16_exception.html" class="nav-link"><span class="nav-chapter-num">16</span><span>ä¾‹å¤–ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°</span></a></li>
                        <li class="nav-item"><a href="17_aop.html" class="nav-link"><span class="nav-chapter-num">17</span><span>AOPã§ãƒ­ã‚°å‡ºåŠ›</span></a></li>
                        <li class="nav-item"><a href="18_transaction.html" class="nav-link"><span class="nav-chapter-num">18</span><span>ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç†</span></a></li>
                    </ul>
                </div>
            </div>
        </nav>

        <div class="container">
            <header class="chapter-header">
                <div class="chapter-badge"><span class="level-badge">ä¸Šç´š</span>ğŸ“• Advanced</div>
                <div class="chapter-number">12</div>
                <h1 class="chapter-title">ãƒ­ã‚°ã‚¤ãƒ³èªè¨¼</h1>
            </header>

            <nav class="toc">
                <h2 class="toc-title">ğŸ“‘ ã“ã®ç« ã®å†…å®¹</h2>
                <ul class="toc-list">
                    <li class="toc-item"><span class="toc-number">12-1</span><span>Spring Securityã®å°å…¥</span></li>
                    <li class="toc-item"><span class="toc-number">12-2</span><span>ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ã®ä½œæˆ</span></li>
                    <li class="toc-item"><span class="toc-number">12-3</span><span>ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†</span></li>
                </ul>
            </nav>

            <section class="section">
                <div class="section-header">
                    <span class="section-number">Section 12-1</span>
                    <h2 class="section-title">Spring Securityã®å°å…¥</h2>
                </div>
                <div class="intro-text">
                    <p><strong>Spring Security</strong>ã‚’ä½¿ã£ã¦ã€ToDoã‚¢ãƒ—ãƒªã«ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ã‚’è¿½åŠ ã—ã¾ã™ã€‚</p>
                </div>

                <div class="module-list">
                    <div class="module-item"><div class="module-icon">ğŸ”’</div><div class="module-content"><h4>Spring Security</h4><p>èªè¨¼ãƒ»èªå¯ã‚’æä¾›ã™ã‚‹Springã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯</p></div></div>
                    <div class="module-item"><div class="module-icon">ğŸ‘¤</div><div class="module-content"><h4>UserDetailsService</h4><p>ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹</p></div></div>
                </div>

                <div class="code-block" id="pom-security">
                    <div class="code-header">
                        <span class="code-title">pom.xmlï¼ˆä¾å­˜é–¢ä¿‚è¿½åŠ ï¼‰</span>
                        <button class="download-btn" onclick="downloadCode('pom-security', 'pom_security.xml')">ğŸ“¥ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
                    </div>
                    <div class="code-content">
                        <pre><code>&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.thymeleaf.extras&lt;/groupId&gt;
    &lt;artifactId&gt;thymeleaf-extras-springsecurity6&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
                    </div>
                </div>

                <div class="code-block" id="security-config">
                    <div class="code-header">
                        <span class="code-title">SecurityConfig.java</span>
                        <button class="download-btn" onclick="downloadCode('security-config', 'SecurityConfig.java')">ğŸ“¥ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
                    </div>
                    <div class="code-content">
                        <pre><code>import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.security.web.SecurityFilterChain;

@Configuration
@EnableWebSecurity
public class SecurityConfig {

    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
        http
            .authorizeHttpRequests(auth -> auth
                .requestMatchers("/css/**", "/js/**", "/images/**").permitAll()
                .requestMatchers("/login", "/register").permitAll()
                .anyRequest().authenticated()
            )
            .formLogin(form -> form
                .loginPage("/login")
                .loginProcessingUrl("/login")
                .defaultSuccessUrl("/todo", true)
                .failureUrl("/login?error=true")
                .permitAll()
            )
            .logout(logout -> logout
                .logoutUrl("/logout")
                .logoutSuccessUrl("/login?logout=true")
                .permitAll()
            );

        return http.build();
    }

    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }
}</code></pre>
                    </div>
                </div>
            </section>

            <section class="section">
                <div class="section-header">
                    <span class="section-number">Section 12-2</span>
                    <h2 class="section-title">ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ã®ä½œæˆ</h2>
                </div>

                <div class="code-block" id="login-html">
                    <div class="code-header">
                        <span class="code-title">login.html</span>
                        <button class="download-btn" onclick="downloadCode('login-html', 'login.html')">ğŸ“¥ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
                    </div>
                    <div class="code-content">
                        <pre><code>&lt;!DOCTYPE html&gt;
&lt;html xmlns:th="http://www.thymeleaf.org"&gt;
&lt;head&gt;
    &lt;title&gt;ãƒ­ã‚°ã‚¤ãƒ³&lt;/title&gt;
    &lt;link rel="stylesheet" th:href="@{/css/style.css}"&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class="login-container"&gt;
        &lt;h1&gt;ãƒ­ã‚°ã‚¤ãƒ³&lt;/h1&gt;

        &lt;!-- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ --&gt;
        &lt;div th:if="${param.error}" class="alert alert-danger"&gt;
            ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“
        &lt;/div&gt;

        &lt;!-- ãƒ­ã‚°ã‚¢ã‚¦ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ --&gt;
        &lt;div th:if="${param.logout}" class="alert alert-success"&gt;
            ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ
        &lt;/div&gt;

        &lt;form th:action="@{/login}" method="post"&gt;
            &lt;div class="form-group"&gt;
                &lt;label for="username"&gt;ãƒ¦ãƒ¼ã‚¶ãƒ¼å&lt;/label&gt;
                &lt;input type="text" id="username" name="username"
                       required autofocus&gt;
            &lt;/div&gt;
            &lt;div class="form-group"&gt;
                &lt;label for="password"&gt;ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰&lt;/label&gt;
                &lt;input type="password" id="password" name="password"
                       required&gt;
            &lt;/div&gt;
            &lt;button type="submit" class="btn btn-primary"&gt;ãƒ­ã‚°ã‚¤ãƒ³&lt;/button&gt;
        &lt;/form&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
                    </div>
                </div>

                <div class="code-block" id="user-details">
                    <div class="code-header">
                        <span class="code-title">CustomUserDetailsService.java</span>
                        <button class="download-btn" onclick="downloadCode('user-details', 'CustomUserDetailsService.java')">ğŸ“¥ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
                    </div>
                    <div class="code-content">
                        <pre><code>import org.springframework.security.core.userdetails.*;
import org.springframework.stereotype.Service;
import java.util.Collections;

@Service
public class CustomUserDetailsService implements UserDetailsService {

    private final UserMapper userMapper;

    public CustomUserDetailsService(UserMapper userMapper) {
        this.userMapper = userMapper;
    }

    @Override
    public UserDetails loadUserByUsername(String username)
            throws UsernameNotFoundException {

        User user = userMapper.findByUsername(username);

        if (user == null) {
            throw new UsernameNotFoundException("ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: " + username);
        }

        return new org.springframework.security.core.userdetails.User(
            user.getUsername(),
            user.getPassword(),
            Collections.singletonList(
                new SimpleGrantedAuthority("ROLE_" + user.getRole())
            )
        );
    }
}</code></pre>
                    </div>
                </div>
            </section>

            <section class="section">
                <div class="section-header">
                    <span class="section-number">Section 12-3</span>
                    <h2 class="section-title">ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†</h2>
                </div>

                <div class="code-block" id="user-entity">
                    <div class="code-header">
                        <span class="code-title">User.javaï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ï¼‰</span>
                        <button class="download-btn" onclick="downloadCode('user-entity', 'User.java')">ğŸ“¥ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
                    </div>
                    <div class="code-content">
                        <pre><code>public class User {
    private Integer id;
    private String username;
    private String password;
    private String role;  // USER or ADMIN

    // getter/setter
}</code></pre>
                    </div>
                </div>

                <div class="code-block" id="user-schema">
                    <div class="code-header">
                        <span class="code-title">schema.sqlï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰</span>
                        <button class="download-btn" onclick="downloadCode('user-schema', 'schema_user.sql')">ğŸ“¥ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
                    </div>
                    <div class="code-content">
                        <pre><code>CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    role VARCHAR(20) DEFAULT 'USER',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);</code></pre>
                    </div>
                </div>

                <h3>Spring Securityç”¨èª</h3>
                <table class="data-table">
                    <thead><tr><th>ç”¨èª</th><th>èª¬æ˜</th></tr></thead>
                    <tbody>
                        <tr><td><code>Authentication</code></td><td>èªè¨¼ï¼ˆæœ¬äººç¢ºèªï¼‰</td></tr>
                        <tr><td><code>Authorization</code></td><td>èªå¯ï¼ˆæ¨©é™ç¢ºèªï¼‰</td></tr>
                        <tr><td><code>Principal</code></td><td>èªè¨¼ã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±</td></tr>
                        <tr><td><code>GrantedAuthority</code></td><td>ä»˜ä¸ã•ã‚ŒãŸæ¨©é™</td></tr>
                    </tbody>
                </table>

                <div class="warning-box">
                    <div class="warning-box-header"><span class="warning-box-icon">âš ï¸</span><span class="warning-box-title">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ä¿å­˜</span></div>
                    <p>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯å¿…ãš<code>BCryptPasswordEncoder</code>ã§ãƒãƒƒã‚·ãƒ¥åŒ–ã—ã¦ä¿å­˜ã—ã¦ãã ã•ã„ã€‚<br>å¹³æ–‡ã§ã®ä¿å­˜ã¯çµ¶å¯¾ã«é¿ã‘ã¾ã—ã‚‡ã†ã€‚</p>
                </div>
            </section>
        </div>

        <footer class="footer"><p>Spring Framework å…¥é–€ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ« - ä¸Šç´šãƒ¬ãƒ™ãƒ«</p></footer>

        <div class="page-nav">
            <a href="11_csv_export.html" class="page-nav-btn prev"><span>â†</span><div><div class="page-nav-label">ä¸­ç´šãƒ¬ãƒ™ãƒ«</div><div class="page-nav-title">CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</div></div></a>
            <a href="13_user_todo.html" class="page-nav-btn next"><div><div class="page-nav-label">æ¬¡ã®æ©Ÿèƒ½</div><div class="page-nav-title">ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥ToDoç®¡ç†</div></div><span>â†’</span></a>
        </div>

        <script>
            function toggleMenu() { document.querySelector(".nav-toggle").classList.toggle("active"); document.querySelector(".nav-menu").classList.toggle("active"); }
            function downloadCode(id, filename) { const el = document.getElementById(id); const code = el.querySelector('code') || el.querySelector('pre'); const blob = new Blob([code.textContent], {type:'text/plain;charset=utf-8'}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = filename; a.click(); URL.revokeObjectURL(url); }
        </script>
    </body>
</html>
