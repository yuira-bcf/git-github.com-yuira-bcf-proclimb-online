<!doctype html>
<html lang="ja">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>ä¸­ç´š11 CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</title>
        <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700;900&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet" />
        <link rel="stylesheet" href="../style.css" />
        <style>
            .download-btn { background: linear-gradient(135deg, #22c55e, #16a34a); color: white; border: none; padding: 6px 14px; border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer; margin-left: auto; }
            .code-header { display: flex; align-items: center; justify-content: space-between; }
            .level-badge { display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: 600; background: #fef9c3; color: #854d0e; margin-right: 8px; }
        </style>
    </head>
    <body>
        <nav class="global-nav">
            <div class="nav-container">
                <a href="../1spring-framework-tutorial.html" class="nav-logo"><span class="nav-logo-icon">ğŸŒ±</span><span>Springå…¥é–€</span></a>
                <button class="nav-toggle" onclick="toggleMenu()"><span></span><span></span><span></span></button>
                <div class="nav-menu">
                    <div class="nav-menu-title">ğŸ“š ä¸­ç´šãƒ¬ãƒ™ãƒ«</div>
                    <ul class="nav-list">
                        <li class="nav-item"><a href="06_pagination.html" class="nav-link"><span class="nav-chapter-num">6</span><span>ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³</span></a></li>
                        <li class="nav-item"><a href="07_priority.html" class="nav-link"><span class="nav-chapter-num">7</span><span>å„ªå…ˆåº¦è¨­å®š</span></a></li>
                        <li class="nav-item"><a href="08_category.html" class="nav-link"><span class="nav-chapter-num">8</span><span>ã‚«ãƒ†ã‚´ãƒª/ã‚¿ã‚°æ©Ÿèƒ½</span></a></li>
                        <li class="nav-item"><a href="09_deadline.html" class="nav-link"><span class="nav-chapter-num">9</span><span>æœŸé™æ—¥ã¨æœŸé™åˆ‡ã‚Œè­¦å‘Š</span></a></li>
                        <li class="nav-item"><a href="10_bulk_delete.html" class="nav-link"><span class="nav-chapter-num">10</span><span>ä¸€æ‹¬å‰Šé™¤æ©Ÿèƒ½</span></a></li>
                        <li class="nav-item"><a href="11_csv_export.html" class="nav-link active"><span class="nav-chapter-num">11</span><span>CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</span></a></li>
                    </ul>
                </div>
            </div>
        </nav>

        <div class="container">
            <header class="chapter-header">
                <div class="chapter-badge"><span class="level-badge">ä¸­ç´š</span>ğŸ“˜ Intermediate</div>
                <div class="chapter-number">11</div>
                <h1 class="chapter-title">CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</h1>
            </header>

            <nav class="toc">
                <h2 class="toc-title">ğŸ“‘ ã“ã®ç« ã®å†…å®¹</h2>
                <ul class="toc-list">
                    <li class="toc-item"><span class="toc-number">11-1</span><span>ãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã®ä»•çµ„ã¿</span></li>
                    <li class="toc-item"><span class="toc-number">11-2</span><span>CSVãƒ•ã‚¡ã‚¤ãƒ«ã®ç”Ÿæˆ</span></li>
                    <li class="toc-item"><span class="toc-number">11-3</span><span>æ–‡å­—åŒ–ã‘å¯¾ç­–</span></li>
                </ul>
            </nav>

            <section class="section">
                <div class="section-header">
                    <span class="section-number">Section 11-1</span>
                    <h2 class="section-title">ãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã®ä»•çµ„ã¿</h2>
                </div>
                <div class="intro-text">
                    <p>ToDoãƒ‡ãƒ¼ã‚¿ã‚’<strong>CSVãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</strong>ã§ãã‚‹æ©Ÿèƒ½ã‚’è¿½åŠ ã—ã¾ã™ã€‚</p>
                </div>

                <div class="module-list">
                    <div class="module-item"><div class="module-icon">ğŸ“¥</div><div class="module-content"><h4>HttpServletResponse</h4><p>ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã®è¨­å®šã¨ãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›ã«ä½¿ç”¨</p></div></div>
                    <div class="module-item"><div class="module-icon">ğŸ“</div><div class="module-content"><h4>Content-Disposition</h4><p>ãƒ–ãƒ©ã‚¦ã‚¶ã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚’æŒ‡ç¤ºã™ã‚‹ãƒ˜ãƒƒãƒ€ãƒ¼</p></div></div>
                </div>
            </section>

            <section class="section">
                <div class="section-header">
                    <span class="section-number">Section 11-2</span>
                    <h2 class="section-title">CSVãƒ•ã‚¡ã‚¤ãƒ«ã®ç”Ÿæˆ</h2>
                </div>

                <div class="code-block" id="controller-csv">
                    <div class="code-header">
                        <span class="code-title">TodoController.java</span>
                        <button class="download-btn" onclick="downloadCode('controller-csv', 'TodoController_csv.java')">ğŸ“¥ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
                    </div>
                    <div class="code-content">
                        <pre><code>import jakarta.servlet.http.HttpServletResponse;
import java.io.PrintWriter;
import java.net.URLEncoder;
import java.nio.charset.StandardCharsets;

/**
 * CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
 */
@GetMapping("/export")
public void exportCsv(HttpServletResponse response) throws Exception {
    List&lt;Todo&gt; todoList = todoService.findAll();

    // ãƒ•ã‚¡ã‚¤ãƒ«åï¼ˆæ—¥æœ¬èªå¯¾å¿œï¼‰
    String filename = URLEncoder.encode("todo_list.csv", StandardCharsets.UTF_8);

    // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼è¨­å®š
    response.setContentType("text/csv; charset=UTF-8");
    response.setHeader("Content-Disposition", "attachment; filename=\"" + filename + "\"");

    // BOMä»˜ãUTF-8ï¼ˆExcelã§æ–‡å­—åŒ–ã‘ã—ãªã„ãŸã‚ï¼‰
    PrintWriter writer = response.getWriter();
    writer.print('\ufeff');  // BOM

    // ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œ
    writer.println("No,ã‚¿ã‚¤ãƒˆãƒ«,ç™»éŒ²è€…,è©³ç´°,ä½œæˆæ—¥");

    // ãƒ‡ãƒ¼ã‚¿è¡Œ
    for (Todo todo : todoList) {
        writer.println(String.format("%d,\"%s\",\"%s\",\"%s\",\"%s\"",
            todo.getId(),
            escapeCsv(todo.getTitle()),
            escapeCsv(todo.getAuthor()),
            escapeCsv(todo.getDetail()),
            todo.getCreatedAt() != null ?
                todo.getCreatedAt().format(DateTimeFormatter.ofPattern("yyyy/MM/dd")) : ""
        ));
    }
}

// CSVç”¨ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
private String escapeCsv(String value) {
    if (value == null) return "";
    return value.replace("\"", "\"\"");
}</code></pre>
                    </div>
                </div>

                <div class="code-block" id="download-btn">
                    <div class="code-header">
                        <span class="code-title">index.htmlï¼ˆãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ï¼‰</span>
                        <button class="download-btn" onclick="downloadCode('download-btn', 'index_export.html')">ğŸ“¥ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
                    </div>
                    <div class="code-content">
                        <pre><code>&lt;div class="action-bar"&gt;
    &lt;a th:href="@{/todo/new}" class="btn btn-primary"&gt;æ–°è¦ç™»éŒ²&lt;/a&gt;
    &lt;a th:href="@{/todo/export}" class="btn btn-secondary"&gt;ğŸ“¥ CSVãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰&lt;/a&gt;
&lt;/div&gt;</code></pre>
                    </div>
                </div>
            </section>

            <section class="section">
                <div class="section-header">
                    <span class="section-number">Section 11-3</span>
                    <h2 class="section-title">æ–‡å­—åŒ–ã‘å¯¾ç­–</h2>
                </div>

                <h3>Excelã§CSVã‚’é–‹ãã¨ãã®å•é¡Œ</h3>
                <table class="data-table">
                    <thead><tr><th>å¯¾ç­–</th><th>èª¬æ˜</th></tr></thead>
                    <tbody>
                        <tr><td><code>BOMä»˜ãUTF-8</code></td><td><code>\ufeff</code>ã‚’å…ˆé ­ã«ä»˜ä¸</td></tr>
                        <tr><td><code>ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆå›²ã¿</code></td><td>ã‚«ãƒ³ãƒã‚’å«ã‚€å€¤ã‚’æ­£ã—ãå‡¦ç†</td></tr>
                        <tr><td><code>ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆã‚¨ã‚¹ã‚±ãƒ¼ãƒ—</code></td><td><code>"</code>ã‚’<code>""</code>ã«ç½®æ›</td></tr>
                    </tbody>
                </table>

                <div class="warning-box">
                    <div class="warning-box-header"><span class="warning-box-icon">âš ï¸</span><span class="warning-box-title">BOMã«ã¤ã„ã¦</span></div>
                    <p>BOMï¼ˆByte Order Markï¼‰ã‚’ä»˜ã‘ã‚‹ã¨ã€ExcelãŒUTF-8ã¨ã—ã¦èªè­˜ã—ã¾ã™ã€‚<br>ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒ‡ã‚£ã‚¿ã§é–‹ãã¨å…ˆé ­ã«ä¸å¯è¦–æ–‡å­—ãŒå…¥ã‚Šã¾ã™ãŒã€æ­£å¸¸ãªå‹•ä½œã§ã™ã€‚</p>
                </div>

                <div class="column">
                    <div class="column-header"><span class="column-badge">Column</span><span class="column-title">ä¸­ç´šãƒ¬ãƒ™ãƒ«å®Œäº†ï¼</span></div>
                    <p>ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼ä¸­ç´šãƒ¬ãƒ™ãƒ«ã®6ã¤ã®æ©Ÿèƒ½ã‚’ã™ã¹ã¦å­¦ç¿’ã—ã¾ã—ãŸã€‚</p>
                    <ol class="step-list">
                        <li>ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ - Pageable, Page&lt;T&gt;</li>
                        <li>å„ªå…ˆåº¦è¨­å®š - Enumå‹ã€selectã‚¿ã‚°</li>
                        <li>ã‚«ãƒ†ã‚´ãƒª/ã‚¿ã‚°æ©Ÿèƒ½ - ãƒ†ãƒ¼ãƒ–ãƒ«çµåˆã€collection</li>
                        <li>æœŸé™æ—¥ã¨æœŸé™åˆ‡ã‚Œè­¦å‘Š - æ—¥ä»˜æ¯”è¼ƒãƒ­ã‚¸ãƒƒã‚¯</li>
                        <li>ä¸€æ‹¬å‰Šé™¤æ©Ÿèƒ½ - ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã€é…åˆ—ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿</li>
                        <li>CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ - ãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</li>
                    </ol>
                    <p style="margin-top: 1rem;">æ¬¡ã¯<strong>ä¸Šç´šãƒ¬ãƒ™ãƒ«</strong>ã«æŒ‘æˆ¦ã—ã¾ã—ã‚‡ã†ï¼</p>
                </div>
            </section>
        </div>

        <footer class="footer"><p>Spring Framework å…¥é–€ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ« - ä¸­ç´šãƒ¬ãƒ™ãƒ«</p></footer>

        <div class="page-nav">
            <a href="10_bulk_delete.html" class="page-nav-btn prev"><span>â†</span><div><div class="page-nav-label">å‰ã®æ©Ÿèƒ½</div><div class="page-nav-title">ä¸€æ‹¬å‰Šé™¤æ©Ÿèƒ½</div></div></a>
            <a href="12_login.html" class="page-nav-btn next"><div><div class="page-nav-label">ä¸Šç´šãƒ¬ãƒ™ãƒ«ã¸</div><div class="page-nav-title">ãƒ­ã‚°ã‚¤ãƒ³èªè¨¼</div></div><span>â†’</span></a>
        </div>

        <script>
            function toggleMenu() { document.querySelector(".nav-toggle").classList.toggle("active"); document.querySelector(".nav-menu").classList.toggle("active"); }
            function downloadCode(id, filename) { const el = document.getElementById(id); const code = el.querySelector('code') || el.querySelector('pre'); const blob = new Blob([code.textContent], {type:'text/plain;charset=utf-8'}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = filename; a.click(); URL.revokeObjectURL(url); }
        </script>
    </body>
</html>
